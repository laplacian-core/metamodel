{{define "project_name" (upper-camel project.name)}}

package {{project.namespace}}.gradle
import laplacian.gradle.task.generate.ExecutionContext
import laplacian.gradle.task.generate.ModelEntryResolver
{{#each entities.top_level as |entity|}}
import {{entity.namespace}}.model.{{entity.class_name}}List
import {{entity.namespace}}.record.{{entity.class_name}}Record
{{/each}}
import laplacian.util.*

class {{project_name}}ModelEntryResolver: ModelEntryResolver {

    override fun resolves(key: String, model: Map<String, RecordList>): Boolean {
        return arrayOf(
            {{#each entities.top_level as |entity|}}
            "{{plural entity.name}}"{{#unless @last}},{{/unless}}
            {{/each}}
        ).any { it == key }
    }

    override fun resolve(key: String, model: Map<String, RecordList>, context: ExecutionContext): Any? {
        return when (key) {
            {{#each entities.top_level as |entity|}}
            "{{plural entity.name}}" -> {{entity.class_name}}List(
                model.getList<Record>("{{plural entity.name}}").map{ {{entity.class_name}}Record(it, context.currentModel) },
                context.currentModel
            )
            {{/each}}
            else -> throw IllegalArgumentException("Unknown key: $key")
        }
    }
}
